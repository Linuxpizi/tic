language: rust
rust:
- stable
- beta
- nightly
os: linux
env: TYPE=default RUST_BACKTRACE=1
matrix:
  include:
    - os: linux
      rust: nightly
      env: TYPE=features RUST_BACKTRACE=1
      script:
        - cargo test --features asm
        - cargo build --features asm
        - cargo test --release --features asm
        - cargo build --release --features asm
    - os: linux
      rust: stable
      env: TYPE=rustfmt RUST_BACKTRACE=1
      script:
        - cargo install rustfmt || cargo fmt -- --version || cargo install -f rustfmt
        - cargo fmt -- --write-mode=diff
    - os: linux
      rust: nightly
      env: TYPE=clippy RUST_BACKTRACE=1
      script:
        - cargo install clippy || cargo clippy -- --version || cargo install -f clippy
        - cargo clippy
  allow_failures:
    - env: TYPE=clippy RUST_BACKTRACE=1